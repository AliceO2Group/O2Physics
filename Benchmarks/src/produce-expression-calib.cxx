// Copyright 2019-2025 CERN and copyright holders of ALICE O2.
// See https://alice-o2.web.cern.ch/copyright for details of the copyright holders.
// All rights not expressly granted are reserved.
//
// This software is distributed under the terms of the GNU General Public
// License v3 (GPL Version 3), copied verbatim in the file "COPYING".
//
// In applying this license CERN does not waive the privileges and immunities
// granted to it by virtue of its status as an Intergovernmental Organization
// or submit itself to any jurisdiction.

#include <CCDB/BasicCCDBManager.h>
#include "Common/CCDB/ctpRateFetcher.h"
#include "Common/DataModel/EventSelection.h"
#include "Common/DataModel/Multiplicity.h"
#include "tables.h"

#include "Framework/AnalysisTask.h"
#include "Framework/runDataProcessing.h"

using namespace o2;
using namespace o2::framework;
using namespace o2::framework::expressions;

float fReal_fTPCSignalN(float mbb0R, float a1pt, float atgl, float side, float occ, float fOccTPCN, float fTrackOccMeanN)
{
  return ((0.019869f * mbb0R) + (0.0012031f * a1pt) + (-0.0031766f * atgl) + (-0.0058023f * atgl * mbb0R) + (0.00087494f * a1pt * mbb0R) + (0.0020074f * side) + (-0.0010434f * a1pt * a1pt) + (0.011812f)) * occ / 1.e3f + //
         ((0.009032f * mbb0R) + (0.0011737f * a1pt) + (-0.0010241f * atgl) + (-0.0075789f * atgl * mbb0R) + (0.00029324f * a1pt * mbb0R) + (0.00052475f * side) + (-0.00045413f * a1pt * a1pt) + (0.0024879f)) * fOccTPCN + //
         ((0.004255f * mbb0R) + (0.0011954f * a1pt) + (0.0054092f * atgl) + (-0.0033655f * atgl * mbb0R) + (0.00052243f * a1pt * mbb0R) + (-0.0002969f * side) + (-0.00074909f * a1pt * a1pt) + (-0.0075754f)) * fTrackOccMeanN + //
         ((-0.07925f * mbb0R) + (-0.03737f * a1pt) + (0.0017054f * atgl) + (0.093686f * atgl * mbb0R) + (0.023925f * a1pt * mbb0R) + (-0.0083407f * side) + (0.00336f * a1pt * a1pt) + (1.0461f));
};

float clamp(float value, float lo, float hi)
{
  return value < lo ? lo : (value > hi ? hi : value);
}

struct LeftJoin {
  Produces<aod::TracksTemporaryExtra> interm;
  Service<o2::ccdb::BasicCCDBManager> ccdb;
  ctpRateFetcher fetcher;

  Preslice<aod::Tracks> perColl = aod::track::collisionId;

  using BCs = soa::Join<aod::BCs, aod::Timestamps>;
  using Collisions = soa::Join<aod::Collisions, aod::Mults, aod::EvSels>;
  using Tracks = soa::Join<aod::Tracks, aod::TracksExtra>;

  int runNumber{0};
  int colId{-100};
  int bcId{-100};
  int trkId{-100};
  Collisions::iterator col;
  BCs::iterator bc;
  Tracks::iterator track;

  void process(BCs const& bcs, Collisions const& collisions, Tracks const& tracks, aod::TracksQAVersion const& tracksQA)
  {
    interm.reserve(tracksQA.size());
    col = collisions.begin();
    bc = bcs.begin();
    runNumber = bc.runNumber();
    track = tracks.begin();
    for (auto& trackqa : tracksQA) {
      if (!trackqa.has_track()) {
        interm(0, 0, 0, 0, 0, o2::constants::math::Almost0, 0);
        continue;
      }
      if (trackqa.trackId() != trkId) {
        track.setCursor(trackqa.trackId());
      }
      if (!track.has_collision()) {
        interm(0, 0, 0, 0, 0, o2::constants::math::Almost0, 0);
        continue;
      }
      if (track.collisionId() != colId) {
        colId = track.collisionId();
        col.setCursor(colId);
      }
      if (!col.has_foundBC()) {
        interm(0, 0, 0, 0, 0, o2::constants::math::Almost0, 0);
        continue;
      }
      if (col.foundBCId() != bcId) {
        bc.setCursor(col.foundBCId());
        if (bc.runNumber() != runNumber) {
          runNumber = bc.runNumber();
        }
      }
      float rate = fetcher.fetch(ccdb.service, bc.timestamp(), runNumber, "ZNC hadronic") * 1.e-3;
      float occ = col.trackOccupancyInTimeRange();
      float fOccTPCN = clamp(col.multTPC() / 1100.f, 0.f, 12.f);
      float c0 = fReal_fTPCSignalN(clamp(50.f / track.tpcSignal(), 0.05f, 1.05f), std::abs(track.signed1Pt()), std::abs(track.tgl()), track.tgl() > 0 ? 1.f : 0.f, occ, fOccTPCN, rate / 5.f);
      interm(rate, fOccTPCN, occ, clamp(c0 * 50.f / track.tpcSignal(), 0.05f, 1.05f), track.tpcSignal(), track.signed1Pt(), track.tgl());
    }
  }
};

struct ProduceExpressionCalib {
  Defines<aod::TracksQACorrectedEFull> qacor;

  void init(InitContext&) {
    // realTPCSignal
    qacor.projectors[0] = ifnode(aod::track::tpcSignal < o2::constants::math::Almost0,
                                 LiteralNode{0.f},
                                 aod::track::tpcSignal / (((0.019869f * aod::intermediate::correction1) + (0.0012031f * nabs(aod::track::signed1Pt)) + (-0.0031766f * nabs(aod::track::tgl)) + (-0.0058023f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00087494f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.0020074f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.0010434f * aod::track::signed1Pt * aod::track::signed1Pt) + (0.011812f)) * aod::intermediate::occupancy / 1.e3f + //
                                                          ((0.009032f * aod::intermediate::correction1) + (0.0011737f * nabs(aod::track::signed1Pt)) + (-0.0010241f * nabs(aod::track::tgl)) + (-0.0075789f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00029324f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00052475f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00045413f * aod::track::signed1Pt * aod::track::signed1Pt) + (0.0024879f)) * aod::intermediate::clampedTPCmult + //
                                                          ((0.004255f * aod::intermediate::correction1) + (0.0011954f * nabs(aod::track::signed1Pt)) + (0.0054092f * nabs(aod::track::tgl)) + (-0.0033655f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00052243f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.0002969f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00074909f * aod::track::signed1Pt * aod::track::signed1Pt) + (-0.0075754f)) * aod::intermediate::hRate / 5.f +    //
                                                          ((-0.07925f * aod::intermediate::correction1) + (-0.03737f * nabs(aod::track::signed1Pt)) + (0.0017054f * nabs(aod::track::tgl)) + (0.093686f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.023925f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.0083407f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00336f * aod::track::signed1Pt * aod::track::signed1Pt) + (1.0461f))                                                    //
                                                          ));

    // qMax0R0
    qacor.projectors[1] = ((0.036419f * aod::intermediate::correction1) + (0.0026895f * nabs(aod::track::signed1Pt)) + (-0.0060575f * nabs(aod::track::tgl)) + (0.0014132f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0019824f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.0027807f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00035062f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.00035707f)) * aod::intermediate::occupancy / 1.e3f //
                          + ((0.018872f * aod::intermediate::correction1) + (0.0025347f * nabs(aod::track::signed1Pt)) + (0.00042624f * nabs(aod::track::tgl)) + (-0.009566f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0013989f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00046257f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00035991f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0035327f)) * aod::intermediate::clampedTPCmult //
                          + ((-0.0013489f * aod::intermediate::correction1) + (-0.0012116f * nabs(aod::track::signed1Pt)) + (0.00095043f * nabs(aod::track::tgl)) + (0.0012604f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.0010987f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.0015823f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-2.0682e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0034631f)) * aod::intermediate::hRate        //
                          + ((0.14845f * aod::intermediate::correction1) + (-0.059922f * nabs(aod::track::signed1Pt)) + (0.088597f * nabs(aod::track::tgl)) + (-0.046773f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.047535f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.0023642f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.0041058f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.81337f));
    // qMax1R0
    qacor.projectors[2] = ((0.021162f * aod::intermediate::correction1) + (0.0047311f * nabs(aod::track::signed1Pt)) + (-0.0050134f * nabs(aod::track::tgl)) + (-0.0020799f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0021859f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.0013058f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00097268f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.00027099f)) * aod::intermediate::occupancy / 1.e3f //
                          + ((0.010442f * aod::intermediate::correction1) + (0.0032625f * nabs(aod::track::signed1Pt)) + (0.00035052f * nabs(aod::track::tgl)) + (-0.0061975f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00095599f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00028564f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00060877f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0034378f)) * aod::intermediate::clampedTPCmult //
                          + ((0.00072113f * aod::intermediate::correction1) + (0.0012692f * nabs(aod::track::signed1Pt)) + (0.0019225f * nabs(aod::track::tgl)) + (-4.9502e-05f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.0002153f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00078837f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00062101f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0054873f)) * aod::intermediate::hRate         //
                          + ((0.057368f * aod::intermediate::correction1) + (-0.078491f * nabs(aod::track::signed1Pt)) + (0.030685f * nabs(aod::track::tgl)) + (-0.026226f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.053421f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.0068194f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.012138f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.93283f));
    // qMax2R0
    qacor.projectors[3] = ((0.011954f * aod::intermediate::correction1) + (0.0046224f * nabs(aod::track::signed1Pt)) + (-0.0051857f * nabs(aod::track::tgl)) + (-0.00081821f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0023337f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.0013618f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00093544f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-6.2866e-05f)) * aod::intermediate::occupancy / 1.e3f //
                          + ((0.0072282f * aod::intermediate::correction1) + (0.0028697f * nabs(aod::track::signed1Pt)) + (0.00079917f * nabs(aod::track::tgl)) + (-0.0042087f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0015179f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-2.2e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.0004591f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0032937f)) * aod::intermediate::clampedTPCmult     //
                          + ((0.0011864f * aod::intermediate::correction1) + (0.0017477f * nabs(aod::track::signed1Pt)) + (0.0019628f * nabs(aod::track::tgl)) + (-0.00099482f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (3.9852e-05f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.0006403f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00070453f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0045286f)) * aod::intermediate::hRate           //
                          + ((0.019613f * aod::intermediate::correction1) + (-0.12656f * nabs(aod::track::signed1Pt)) + (0.019093f * nabs(aod::track::tgl)) + (-0.035163f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.081274f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.0038576f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.026742f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.97812f));
    // qMax3R0
    qacor.projectors[4] = ((0.006657f * aod::intermediate::correction1) + (0.0027675f * nabs(aod::track::signed1Pt)) + (-0.0075368f * nabs(aod::track::tgl)) + (-2.647e-05f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00045219f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00022622f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00059026f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.002745f)) * aod::intermediate::occupancy / 1.e3f //
                          + ((0.0072501f * aod::intermediate::correction1) + (0.0028788f * nabs(aod::track::signed1Pt)) + (0.0018944f * nabs(aod::track::tgl)) + (-0.0050865f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0012857f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-1.9644e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00039888f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.004457f)) * aod::intermediate::clampedTPCmult //
                          + ((0.0093193f * aod::intermediate::correction1) + (0.01292f * nabs(aod::track::signed1Pt)) + (-0.001179f * nabs(aod::track::tgl)) + (0.0034663f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.005494f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00023943f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.0031454f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.015039f)) * aod::intermediate::hRate               //
                          + ((0.031517f * aod::intermediate::correction1) + (-0.12968f * nabs(aod::track::signed1Pt)) + (0.013073f * nabs(aod::track::tgl)) + (-0.013104f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.064576f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.0037192f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.035161f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.94643f));

    // qMax0R0_mad
    qacor.projectors[5] = ((0.0032739f * aod::intermediate::correction1) + (-0.00083832f * nabs(aod::track::signed1Pt)) + (-0.0013899f * nabs(aod::track::tgl)) + (0.00031148f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (3.3722e-05f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00035792f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00022816f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0020259f)) * aod::intermediate::occupancy / 1.e3f //
                          + ((0.0011825f * aod::intermediate::correction1) + (-0.00087854f * nabs(aod::track::signed1Pt)) + (-0.00060302f * nabs(aod::track::tgl)) + (-8.301e-06f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.000603f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00014523f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00021131f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.00089158f)) * aod::intermediate::clampedTPCmult  //
                          + ((-0.00039752f * aod::intermediate::correction1) + (-0.00067871f * nabs(aod::track::signed1Pt)) + (-0.00042804f * nabs(aod::track::tgl)) + (0.0003994f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.0003911f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (7.6255e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00019167f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.00064082f)) * aod::intermediate::hRate         //
                          + ((0.05757f * aod::intermediate::correction1) + (-0.00010976f * nabs(aod::track::signed1Pt)) + (-0.0053188f * nabs(aod::track::tgl)) + (-0.010717f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0075574f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.003877f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00013875f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.049855f));
    // qMax1R0_mad
    qacor.projectors[6] = ((0.0045549f * aod::intermediate::correction1) + (0.00087673f * nabs(aod::track::signed1Pt)) + (-0.0008244f * nabs(aod::track::tgl)) + (-0.00084722f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00076807f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00026f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-8.4332e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.00046328f)) * aod::intermediate::occupancy / 1.e3f   //
                          + ((0.00077207f * aod::intermediate::correction1) + (-0.00066463f * nabs(aod::track::signed1Pt)) + (-0.00028896f * nabs(aod::track::tgl)) + (-0.00051748f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00052313f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00020918f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00012531f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.00077041f)) * aod::intermediate::clampedTPCmult //
                          + ((-0.001964f * aod::intermediate::correction1) + (-0.0018987f * nabs(aod::track::signed1Pt)) + (-0.00051532f * nabs(aod::track::tgl)) + (0.00090779f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00092927f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-3.5317e-06f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00038901f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0023439f)) * aod::intermediate::hRate             //
                          + ((0.052395f * aod::intermediate::correction1) + (0.0051874f * nabs(aod::track::signed1Pt)) + (-0.0046362f * nabs(aod::track::tgl)) + (-0.010693f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0031306f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00029953f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.0014752f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.05555f));
    // qMax2R0_mad
    qacor.projectors[7] = ((0.0028109f * aod::intermediate::correction1) + (0.00154f * nabs(aod::track::signed1Pt)) + (-0.0014824f * nabs(aod::track::tgl)) + (0.00076005f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.001141f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00019105f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00022128f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.00068869f)) * aod::intermediate::occupancy / 1.e3f       //
                          + ((0.00050553f * aod::intermediate::correction1) + (-0.00021518f * nabs(aod::track::signed1Pt)) + (-0.00018194f * nabs(aod::track::tgl)) + (-0.00051275f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00028182f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-8.0412e-06f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (1.7056e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.00046885f)) * aod::intermediate::clampedTPCmult //
                          + ((0.0014012f * aod::intermediate::correction1) + (0.00080437f * nabs(aod::track::signed1Pt)) + (4.4211e-05f * nabs(aod::track::tgl)) + (-0.00021537f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00062642f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (4.8299e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00012079f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.001307f)) * aod::intermediate::hRate             //
                          + ((0.025323f * aod::intermediate::correction1) + (-0.017098f * nabs(aod::track::signed1Pt)) + (-0.0016086f * nabs(aod::track::tgl)) + (-0.015473f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.010693f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.0010934f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.0034083f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.079031f));
    // qMax3R0_mad
    qacor.projectors[8] = ((-0.0016565f * aod::intermediate::correction1) + (-0.0019009f * nabs(aod::track::signed1Pt)) + (-0.00018012f * nabs(aod::track::tgl)) + (-0.00050733f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00084566f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00033188f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00034497f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.003469f)) * aod::intermediate::occupancy / 1.e3f //
                          + ((0.0013034f * aod::intermediate::correction1) + (0.001231f * nabs(aod::track::signed1Pt)) + (-0.00029108f * nabs(aod::track::tgl)) + (0.00046219f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00068638f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (7.6018e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00027657f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0010937f)) * aod::intermediate::clampedTPCmult  //
                          + ((-0.0017241f * aod::intermediate::correction1) + (-0.0024624f * nabs(aod::track::signed1Pt)) + (-0.00029956f * nabs(aod::track::tgl)) + (0.00051832f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.0011205f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (1.466e-06f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00064987f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0022073f)) * aod::intermediate::hRate             //
                          + ((0.027891f * aod::intermediate::correction1) + (-0.042432f * nabs(aod::track::signed1Pt)) + (0.018144f * nabs(aod::track::tgl)) + (-0.036612f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.01245f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00057199f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.013407f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.086444f));

    // qTot0R0
    qacor.projectors[9] = ((0.05379f * aod::intermediate::correction1) + (0.0078357f * nabs(aod::track::signed1Pt)) + (-0.0045679f * nabs(aod::track::tgl)) + (-0.0055742f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0045914f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.0034146f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.001886f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0015936f)) * aod::intermediate::occupancy / 1.e3f    //
                          + ((0.019984f * aod::intermediate::correction1) + (0.00074509f * nabs(aod::track::signed1Pt)) + (-0.0014629f * nabs(aod::track::tgl)) + (-0.014526f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00027911f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00076815f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00027441f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.003094f)) * aod::intermediate::clampedTPCmult //
                          + ((0.0074452f * aod::intermediate::correction1) + (-0.0012576f * nabs(aod::track::signed1Pt)) + (0.0076864f * nabs(aod::track::tgl)) + (-0.0057527f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.0010178f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00060637f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00021891f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0079396f)) * aod::intermediate::hRate        //
                          + ((-0.14994f * aod::intermediate::correction1) + (-0.025556f * nabs(aod::track::signed1Pt)) + (-0.0027218f * nabs(aod::track::tgl)) + (0.094753f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.024869f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.0059085f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00031196f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (1.0614f));
    // qTot1R0
    qacor.projectors[10] = ((0.022051f * aod::intermediate::correction1) + (0.0054705f * nabs(aod::track::signed1Pt)) + (-0.0027645f * nabs(aod::track::tgl)) + (-0.0080202f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0010462f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.0019932f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.0021057f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0095212f)) * aod::intermediate::occupancy / 1.e3f     //
                           + ((0.0091488f * aod::intermediate::correction1) + (0.0033904f * nabs(aod::track::signed1Pt)) + (-0.0012161f * nabs(aod::track::tgl)) + (-0.0071031f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00043533f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00059263f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00097877f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.00075281f)) * aod::intermediate::clampedTPCmult //
                           + ((0.0065562f * aod::intermediate::correction1) + (0.0035568f * nabs(aod::track::signed1Pt)) + (0.0055333f * nabs(aod::track::tgl)) + (-0.0034575f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00084672f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00021743f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.0011436f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.010477f)) * aod::intermediate::hRate            //
                           + ((-0.076084f * aod::intermediate::correction1) + (-0.047299f * nabs(aod::track::signed1Pt)) + (-0.0033743f * nabs(aod::track::tgl)) + (0.078502f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.029237f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.011353f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.0062695f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (1.0308f));
    // qTot2R0
    qacor.projectors[11] = ((0.013053f * aod::intermediate::correction1) + (0.0052803f * nabs(aod::track::signed1Pt)) + (-0.002833f * nabs(aod::track::tgl)) + (-0.0067229f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0015083f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.0014132f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.0017529f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0045371f)) * aod::intermediate::occupancy / 1.e3f       //
                           + ((0.0046757f * aod::intermediate::correction1) + (0.0019132f * nabs(aod::track::signed1Pt)) + (-0.00092483f * nabs(aod::track::tgl)) + (-0.0040224f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00017565f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00014709f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00054281f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.00059496f)) * aod::intermediate::clampedTPCmult //
                           + ((0.0024731f * aod::intermediate::correction1) + (0.0012129f * nabs(aod::track::signed1Pt)) + (0.0041885f * nabs(aod::track::tgl)) + (-0.0030637f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00053027f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00064605f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00073676f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0048447f)) * aod::intermediate::hRate            //
                           + ((-0.03766f * aod::intermediate::correction1) + (-0.017712f * nabs(aod::track::signed1Pt)) + (-0.0048423f * nabs(aod::track::tgl)) + (0.094793f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.016855f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.0063542f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00066842f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.9918f));
    // qTot3R0
    qacor.projectors[12] = ((0.01012f * aod::intermediate::correction1) + (0.0045905f * nabs(aod::track::signed1Pt)) + (-0.0060295f * nabs(aod::track::tgl)) + (-0.0045184f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0011767f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00018135f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.0013776f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0030707f)) * aod::intermediate::occupancy / 1.e3f    //
                           + ((0.0034954f * aod::intermediate::correction1) + (0.0005948f * nabs(aod::track::signed1Pt)) + (-0.0006857f * nabs(aod::track::tgl)) + (-0.0032487f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00063149f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00010616f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00014182f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.00016516f)) * aod::intermediate::clampedTPCmult //
                           + ((0.012009f * aod::intermediate::correction1) + (0.01333f * nabs(aod::track::signed1Pt)) + (0.0026538f * nabs(aod::track::tgl)) + (-0.0024246f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0051234f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (9.6145e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.0033937f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.016958f)) * aod::intermediate::hRate                //
                           + ((-0.055659f * aod::intermediate::correction1) + (0.0060279f * nabs(aod::track::signed1Pt)) + (-0.024762f * nabs(aod::track::tgl)) + (0.1707f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.010545f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.0053018f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00751f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.96645f));

    // qTot0R0_mad
    qacor.projectors[13] = ((0.010376f * aod::intermediate::correction1) + (0.0020723f * nabs(aod::track::signed1Pt)) + (0.00023197f * nabs(aod::track::tgl)) + (-0.003087f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0014009f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00062246f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00057047f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.00074635f)) * aod::intermediate::occupancy / 1.e3f   //
                           + ((0.0039974f * aod::intermediate::correction1) + (-5.2525e-05f * nabs(aod::track::signed1Pt)) + (-0.00054452f * nabs(aod::track::tgl)) + (-0.0017733f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00038107f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00018845f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (4.6742e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (4.6125e-05f)) * aod::intermediate::clampedTPCmult //
                           + ((0.0011989f * aod::intermediate::correction1) + (1.3873e-05f * nabs(aod::track::signed1Pt)) + (0.0001106f * nabs(aod::track::tgl)) + (-0.00039192f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00012419f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-4.8745e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (2.8361e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.00013149f)) * aod::intermediate::hRate         //
                           + ((0.061978f * aod::intermediate::correction1) + (-2.0672e-05f * nabs(aod::track::signed1Pt)) + (-0.0029687f * nabs(aod::track::tgl)) + (-0.020046f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0068452f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.0060925f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.001742f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.068078f));
    // qTot1R0_mad
    qacor.projectors[14] = ((0.0051282f * aod::intermediate::correction1) + (-0.00036785f * nabs(aod::track::signed1Pt)) + (-0.00018229f * nabs(aod::track::tgl)) + (-0.0021317f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-3.9574e-05f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00046985f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-6.4708e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0022778f)) * aod::intermediate::occupancy / 1.e3f //
                           + ((0.0011332f * aod::intermediate::correction1) + (-0.00057264f * nabs(aod::track::signed1Pt)) + (-0.00048459f * nabs(aod::track::tgl)) + (-0.00053628f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00054566f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00020773f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (6.1131e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0013186f)) * aod::intermediate::clampedTPCmult   //
                           + ((-0.0014294f * aod::intermediate::correction1) + (-0.0016395f * nabs(aod::track::signed1Pt)) + (0.00050097f * nabs(aod::track::tgl)) + (0.00019716f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.0011792f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-6.9506e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00028175f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0018185f)) * aod::intermediate::hRate              //
                           + ((0.049612f * aod::intermediate::correction1) + (0.00022664f * nabs(aod::track::signed1Pt)) + (0.00069225f * nabs(aod::track::tgl)) + (-0.018209f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.001862f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00013476f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.0017829f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.067225f));
    // qTot2R0_mad
    qacor.projectors[15] = ((0.00030261f * aod::intermediate::correction1) + (-0.0023321f * nabs(aod::track::signed1Pt)) + (-0.00052643f * nabs(aod::track::tgl)) + (-0.0013095f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.0012352f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00021252f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00039201f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0041364f)) * aod::intermediate::occupancy / 1.e3f //
                           + ((7.5596e-05f * aod::intermediate::correction1) + (-0.0009219f * nabs(aod::track::signed1Pt)) + (-0.00017619f * nabs(aod::track::tgl)) + (-0.0006923f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00048164f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (6.911e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00014689f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0015109f)) * aod::intermediate::clampedTPCmult  //
                           + ((0.00026771f * aod::intermediate::correction1) + (-7.3137e-05f * nabs(aod::track::signed1Pt)) + (0.0010327f * nabs(aod::track::tgl)) + (-0.0010829f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00032905f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (9.1216e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-6.3908e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0001052f)) * aod::intermediate::hRate         //
                           + ((0.045023f * aod::intermediate::correction1) + (-0.0012833f * nabs(aod::track::signed1Pt)) + (-0.0011393f * nabs(aod::track::tgl)) + (-0.0128f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00054145f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00012961f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00057735f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.063766f));
    // qTot3R0_mad
    qacor.projectors[16] = ((2.4179e-05f * aod::intermediate::correction1) + (-0.0022156f * nabs(aod::track::signed1Pt)) + (0.00063391f * nabs(aod::track::tgl)) + (-0.0025629f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.0012503f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00035431f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.0003733f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0031568f)) * aod::intermediate::occupancy / 1.e3f     //
                           + ((0.00064537f * aod::intermediate::correction1) + (-0.00022771f * nabs(aod::track::signed1Pt)) + (-0.00052572f * nabs(aod::track::tgl)) + (-0.00013851f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00017452f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (5.8377e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (8.395e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.00032015f)) * aod::intermediate::clampedTPCmult //
                           + ((-0.0019497f * aod::intermediate::correction1) + (-0.0031993f * nabs(aod::track::signed1Pt)) + (0.0010855f * nabs(aod::track::tgl)) + (-0.00057412f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.0012335f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00015677f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00076355f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0028201f)) * aod::intermediate::hRate              //
                           + ((0.020865f * aod::intermediate::correction1) + (-0.058609f * nabs(aod::track::signed1Pt)) + (0.022839f * nabs(aod::track::tgl)) + (-0.031806f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.016076f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.0010281f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.016455f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.10016f));

    // qMaxTot0
    qacor.projectors[17] = ((-0.011295f * aod::intermediate::correction1) + (-0.001087f * nabs(aod::track::signed1Pt)) + (-0.0031759f * nabs(aod::track::tgl)) + (0.007727f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-6.3106e-06f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00051982f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00053087f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.00089624f)) * aod::intermediate::occupancy / 1.e3f //
                           + ((-0.0011264f * aod::intermediate::correction1) + (0.0015426f * nabs(aod::track::signed1Pt)) + (0.0018148f * nabs(aod::track::tgl)) + (0.0034001f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0014034f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00026979f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00017022f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0042007f)) * aod::intermediate::clampedTPCmult  //
                           + ((-0.0052403f * aod::intermediate::correction1) + (-0.0014282f * nabs(aod::track::signed1Pt)) + (-0.0029884f * nabs(aod::track::tgl)) + (0.0036363f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00052755f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.0011482f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00036221f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0021188f)) * aod::intermediate::hRate            //
                           + ((0.29443f * aod::intermediate::correction1) + (-0.016326f * nabs(aod::track::signed1Pt)) + (0.084094f * nabs(aod::track::tgl)) + (-0.13113f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.021916f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.0053678f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00047673f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.73264f));
    // qMaxTot1
    qacor.projectors[18] = ((0.0011394f * aod::intermediate::correction1) + (0.0028785f * nabs(aod::track::signed1Pt)) + (-0.0026975f * nabs(aod::track::tgl)) + (0.0068239f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0032394f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00024361f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.0001246f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.010253f)) * aod::intermediate::occupancy / 1.e3f    //
                           + ((0.00055046f * aod::intermediate::correction1) + (-0.00051361f * nabs(aod::track::signed1Pt)) + (0.0015337f * nabs(aod::track::tgl)) + (0.001474f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00059542f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00033977f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00042607f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0031188f)) * aod::intermediate::clampedTPCmult //
                           + ((-0.004931f * aod::intermediate::correction1) + (-0.0036774f * nabs(aod::track::signed1Pt)) + (-0.0017014f * nabs(aod::track::tgl)) + (0.0023117f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.0018169f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00049096f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.0008295f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0040567f)) * aod::intermediate::hRate              //
                           + ((0.15081f * aod::intermediate::correction1) + (-0.016878f * nabs(aod::track::signed1Pt)) + (0.029106f * nabs(aod::track::tgl)) + (-0.10469f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.017923f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.003732f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.0033021f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.87985f));
    // qMaxTot2
    qacor.projectors[19] = ((0.0038681f * aod::intermediate::correction1) + (0.0054964f * nabs(aod::track::signed1Pt)) + (-0.0011662f * nabs(aod::track::tgl)) + (0.004913f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0037561f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-1.4101e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00061975f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.010448f)) * aod::intermediate::occupancy / 1.e3f   //
                           + ((0.0019623f * aod::intermediate::correction1) + (0.00028139f * nabs(aod::track::signed1Pt)) + (0.0021717f * nabs(aod::track::tgl)) + (-0.00046209f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0010646f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00023386f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00022279f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0031211f)) * aod::intermediate::clampedTPCmult //
                           + ((-0.001751f * aod::intermediate::correction1) + (-0.0019385f * nabs(aod::track::signed1Pt)) + (-0.0013717f * nabs(aod::track::tgl)) + (0.0012036f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00056936f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-3.1006e-06f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00060137f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0014547f)) * aod::intermediate::hRate            //
                           + ((0.088494f * aod::intermediate::correction1) + (-0.078423f * nabs(aod::track::signed1Pt)) + (0.011554f * nabs(aod::track::tgl)) + (-0.1185f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.0446f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (9.0607e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.020254f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.95417f));
    // qMaxTot3
    qacor.projectors[20] = ((9.8263e-05f * aod::intermediate::correction1) + (0.0019565f * nabs(aod::track::signed1Pt)) + (-0.0020669f * nabs(aod::track::tgl)) + (0.0051386f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0015196f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00022648f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.0001314f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0044507f)) * aod::intermediate::occupancy / 1.e3f //
                           + ((0.0039512f * aod::intermediate::correction1) + (0.0027043f * nabs(aod::track::signed1Pt)) + (0.0027183f * nabs(aod::track::tgl)) + (-0.0021564f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0019754f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-9.8236e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.0003849f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0048656f)) * aod::intermediate::clampedTPCmult //
                           + ((0.0015951f * aod::intermediate::correction1) + (0.0030524f * nabs(aod::track::signed1Pt)) + (-0.0021155f * nabs(aod::track::tgl)) + (0.004186f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0020921f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00049161f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00043331f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0032405f)) * aod::intermediate::hRate          //
                           + ((0.078899f * aod::intermediate::correction1) + (-0.14603f * nabs(aod::track::signed1Pt)) + (0.034436f * nabs(aod::track::tgl)) + (-0.17042f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.05807f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-0.00053445f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.045416f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.98711f));

    // qMaxTot0_mad
    qacor.projectors[21] = ((0.00081584f * aod::intermediate::correction1) + (0.00060523f * nabs(aod::track::signed1Pt)) + (-0.00077368f * nabs(aod::track::tgl)) + (0.00058048f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00055331f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (9.2515e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-7.2075e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.00040485f)) * aod::intermediate::occupancy / 1.e3f //
                           + ((0.00078366f * aod::intermediate::correction1) + (0.00032795f * nabs(aod::track::signed1Pt)) + (-0.00035044f * nabs(aod::track::tgl)) + (-0.00010332f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00015074f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (3.965e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-6.6383e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.00023799f)) * aod::intermediate::clampedTPCmult //
                           + ((0.00046204f * aod::intermediate::correction1) + (0.00046443f * nabs(aod::track::signed1Pt)) + (-2.0903e-05f * nabs(aod::track::tgl)) + (5.8387e-05f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00025348f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (4.4914e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-9.0766e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.00033152f)) * aod::intermediate::hRate          //
                           + ((0.027694f * aod::intermediate::correction1) + (-0.0011263f * nabs(aod::track::signed1Pt)) + (0.0032024f * nabs(aod::track::tgl)) + (-0.01575f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0016355f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.0042554f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00065342f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.024298f));
    // qMaxTot1_mad
    qacor.projectors[22] = ((0.00030083f * aod::intermediate::correction1) + (0.00032633f * nabs(aod::track::signed1Pt)) + (-0.00089213f * nabs(aod::track::tgl)) + (0.00050071f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00038379f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00013246f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-3.0354e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0011596f)) * aod::intermediate::occupancy / 1.e3f //
                           + ((0.0011627f * aod::intermediate::correction1) + (0.001223f * nabs(aod::track::signed1Pt)) + (-0.00011221f * nabs(aod::track::tgl)) + (-0.00038303f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00041462f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (7.419e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00031261f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.00089038f)) * aod::intermediate::clampedTPCmult   //
                           + ((-0.00081109f * aod::intermediate::correction1) + (-0.00065714f * nabs(aod::track::signed1Pt)) + (4.2318e-05f * nabs(aod::track::tgl)) + (0.00013371f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00027371f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (5.869e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00013454f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0010851f)) * aod::intermediate::hRate             //
                           + ((0.022513f * aod::intermediate::correction1) + (0.0001983f * nabs(aod::track::signed1Pt)) + (0.0016327f * nabs(aod::track::tgl)) + (-0.013841f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0020134f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00013836f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.0010369f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.027599f));
    // qMaxTot2_mad
    qacor.projectors[23] = ((-0.00055972f * aod::intermediate::correction1) + (-5.4245e-05f * nabs(aod::track::signed1Pt)) + (-0.00086381f * nabs(aod::track::tgl)) + (0.00045553f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00011785f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00012989f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (2.403e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0015619f)) * aod::intermediate::occupancy / 1.e3f  //
                           + ((0.00036557f * aod::intermediate::correction1) + (0.00044828f * nabs(aod::track::signed1Pt)) + (-0.00033607f * nabs(aod::track::tgl)) + (7.8166e-05f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-6.3217e-05f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-3.2699e-07f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00011895f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.0001779f)) * aod::intermediate::clampedTPCmult //
                           + ((0.00026633f * aod::intermediate::correction1) + (0.00052126f * nabs(aod::track::signed1Pt)) + (-6.9848e-05f * nabs(aod::track::tgl)) + (0.00025286f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00033007f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (8.4534e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00011899f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (-0.00024994f)) * aod::intermediate::hRate          //
                           + ((0.028394f * aod::intermediate::correction1) + (0.0062708f * nabs(aod::track::signed1Pt)) + (0.0097613f * nabs(aod::track::tgl)) + (-0.025715f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0040359f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-7.9959e-06f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (7.2706e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.018673f));
    // qMaxTot3_mad
    qacor.projectors[24] = ((0.00031711f * aod::intermediate::correction1) + (0.0010899f * nabs(aod::track::signed1Pt)) + (-0.00042976f * nabs(aod::track::tgl)) + (-0.00021686f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00044157f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (6.7083e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00026787f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.00018337f)) * aod::intermediate::occupancy / 1.e3f //
                           + ((-0.00049422f * aod::intermediate::correction1) + (-0.00047902f * nabs(aod::track::signed1Pt)) + (-0.00030815f * nabs(aod::track::tgl)) + (2.2409e-05f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00035703f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (-1.1649e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (8.7419e-05f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.00080965f)) * aod::intermediate::clampedTPCmult //
                           + ((-9.4331e-05f * aod::intermediate::correction1) + (-9.6348e-05f * nabs(aod::track::signed1Pt)) + (-0.00057261f * nabs(aod::track::tgl)) + (0.00085743f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.00016598f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (1.233e-06f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00010932f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.00019994f)) * aod::intermediate::hRate           //
                           + ((0.020742f * aod::intermediate::correction1) + (-0.023041f * nabs(aod::track::signed1Pt)) + (0.030993f * nabs(aod::track::tgl)) + (-0.046481f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.0041709f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00054496f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.010326f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.035667f));
  }
};

WorkflowSpec defineDataProcessing(ConfigContext const& cfgc)
{
  return {adaptAnalysisTask<LeftJoin>(cfgc), adaptAnalysisTask<ProduceExpressionCalib>(cfgc)};
}

/*
float fReal_fTPCSignalN_mad(float aod::intermediate::correction1, float nabs(aod::track::signed1Pt), float nabs(aod::track::tgl),   float ifnode(aod::track::tgl > 0.f, 1.f, 0.f),  float occ, float aod::intermediate::clampedTPCmult, float aod::intermediate::hRate) {
return ((0.0022684f * aod::intermediate::correction1) + (0.0010606f * nabs(aod::track::signed1Pt)) + (-6.7709e-06f * nabs(aod::track::tgl)) + (-0.0012901f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (1.809e-05f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (7.4229e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (-0.00031708f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (8.2362e-05f)) * aod::intermediate::occupancy / 1.e3f //
      + ((-0.00015603f * aod::intermediate::correction1) + (-0.0007137f * nabs(aod::track::signed1Pt)) + (-0.00029446f * nabs(aod::track::tgl)) + (-3.6583e-05f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00065671f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.00013936f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00012159f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.0011442f)) * aod::intermediate::clampedTPCmult //
      + ((-0.00024348f * aod::intermediate::correction1) + (-0.00082385f * nabs(aod::track::signed1Pt)) + (0.00053475f * nabs(aod::track::tgl)) + (-0.00024263f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (0.00033506f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (1.009e-05f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00016525f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.00071934f)) * aod::intermediate::hRate //
      + ((0.026912f * aod::intermediate::correction1) + (-0.0022536f * nabs(aod::track::signed1Pt)) + (-0.0018352f * nabs(aod::track::tgl)) + (-0.0050977f * nabs(aod::track::tgl) * aod::intermediate::correction1) + (-0.0041775f * nabs(aod::track::signed1Pt) * aod::intermediate::correction1) + (0.0010817f * ifnode(aod::track::tgl > 0.f, 1.f, 0.f)) + (0.00032f * nabs(aod::track::signed1Pt) * nabs(aod::track::signed1Pt)) + (0.042308f));
};
*/
