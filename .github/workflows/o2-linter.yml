---
# Find code issues in modified text files
name: O2 linter

'on': [pull_request, push]
permissions: {}
env:
  MAIN_BRANCH: master

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.run_id }}
  cancel-in-progress: true

jobs:
  o2-linter:
    name: Lint O2 code
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # needed to get the full history
      # - name: Fetch upstream
      #   run: |
      #     # Fetch the main upstream branch to find the common ancestor
      #     git config --global user.name "Nemo" # required on some servers
      #     git remote add upstream https://github.com/AliceO2Group/Run3Analysisvalidation.git || exit 1
      #     git fetch upstream ${{ env.MAIN_BRANCH }} || exit 1
      - name: Run tests
        run: |
          git remote -v
          # Diff against the common ancestor of the source branch and the target branch.
          files=$(git diff --diff-filter d --name-only ${{ env.MAIN_BRANCH }}...)
          python Scripts/o2_linter.py -g $files
          done
